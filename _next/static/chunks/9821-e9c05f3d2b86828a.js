"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9821],{49821:function(e,t,n){n.d(t,{C:function(){return Z}});var r=n(57135),o=n(66091),i=n(57988),s=n(72006),a=n(96583),l=n(3965),u=n(65707),c=n(33048),d=n(62697),h=n(57995),m=n(74579),w=n(98502),v=n(7685),p=n(35122),g=n(89156),f=n(54235),k=n(81666),b=n(82562),S=n(56730),y=n(50208),_=n(43836),T=n(51142),E=n(1839),V=function(){function e(){var t=this;(0,o.Z)(this,e),this.chain=w.R.name.toLowerCase(),this.inSweepMode=new g.mZ,this.inOrderBookMode=new g.mZ({value:!1}),this.inOrderBookSellMode=new g.mZ({value:!1}),this.inOrderBookVisibleMode=new g.mZ({value:!1}),this.refreshFlag=new g.xf({value:Date.now().toString()}),this.bannerInfoSmallView=new g.mZ,this.bannerInfoSmallViewAnimating=new g.mZ({value:!1}),this.itemsScrollViewOffsetTop=new g.$Y({value:0}),this.sweepModalVisible=new g.mZ,this.sweepSelectedTokens=new Set,this.sweepSubmitStepTips=new g.xf,this.sweepSubmitErrorTips=new g.xf,this.bidOrders=new g.$Y({value:[]}),this.marketSells=new g.$Y({value:[]}),this.ownerTokens=new g.$Y({value:[]}),this.selectedOwnerTokens=new Set,this.activitiesFilter={types:[]},this.ableSweepTokens=[],this.ableSweepTokensLoading=new g.mZ;var n=this;this.sweepSubmitState=new l.C({function:function(){var e=(0,r.Z)((function(e){var t,r,o,i;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:n.sweepSubmitErrorTips.setValue(""),a.label=1;case 1:return a.trys.push([1,3,4,5]),t=(0,f.bh)(),(r=t.zeroGasShoppingcart.tokensPriceState.value)&&r.length&&t.god.currentNetwork.walletClient?(r.length,(0,k.j)("buy-request",(0,b.P)(r)),o={items:r.map((function(e){var t,n;return{token:"".concat(null===(t=e.token)||void 0===t?void 0:t.contract,":").concat(null===(n=e.token)||void 0===n?void 0:n.tokenId)}})),wallet:t.god.currentNetwork.walletClient,expectedPrice:t.shoppingcart.totalPrice?{"0x0000000000000000000000000000000000000000":{amount:Number(t.shoppingcart.totalPrice)}}:void 0,options:(0,s.Z)({},t.market.signerGasParams),onProgress:function(e){e.every((function(e){var t;return null===(t=e.items)||void 0===t?void 0:t.every((function(t){return"complete"!==t.status&&n.sweepSubmitStepTips.setValue(e.action),"complete"===t.status}))}))}},[4,h.Z.getClient(n.chainId).actions.buyToken(o)]):[2,null];case 2:return a.sent(),S.Y.emit("token.buy.success",r.map((function(e){return(0,p.sH)(e)}))),null===e||void 0===e||e(),[3,5];case 3:"price mismatch"==(i=a.sent()).type&&S.Y.emit("error.buy.priceMismatch");try{(0,m.fG)(i)}catch(l){n.sweepSubmitErrorTips.setValue(i.message),setTimeout((function(){n.sweepSubmitErrorTips.setValue("")}),3e3)}return[3,5];case 4:return S.Y.emit("wallet.data.refresh"),[7];case 5:return[2]}}))}));return function(t){return e.apply(this,arguments)}}()});var i=this;this.sweep0GasSubmitState=new l.C({function:function(){var e=(0,r.Z)((function(e){var t,n,r,o,s,l,u,h,m,w,v,g,k,b,V,C,Z,I,z,M,F,N,x,B,G,O,Y;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:(s=(0,f.bh)()).god.walletActionCheck(T.S9),i.sweepSubmitErrorTips.setValue(""),u=null!==(l=null===(t=s.user)||void 0===t||null===(n=t.zeroGasExchangeInfo)||void 0===n?void 0:n.order_minimum_money)&&void 0!==l?l:0,m=null!==(h=null===(r=s.user)||void 0===r||null===(o=r.zeroGasExchangeInfo)||void 0===o?void 0:o.order_maximum_batch)&&void 0!==h?h:0,a.label=1;case 1:if(a.trys.push([1,7,8,9]),g=(0,f.bh)(),!(k=g.zeroGasShoppingcart.shoppingCardIdsStore.value)||!k.length||!g.god.currentNetwork.signer)return[2,null];if(k.length,b=i.ableSweepTokens.filter((function(e){var t,n="".concat(e.token.contract,":").concat(null===(t=e.token)||void 0===t?void 0:t.tokenId);return k.includes(n)})),V={network:(0,E.ns)(T.S9),address:null===(v=g.god.account)||void 0===v?void 0:v.toLocaleLowerCase(),side:"BUY",order_type:"LIMIT",orders:b.map((function(e){var t,n,r,o,i,s;return{order_id:"",token:"".concat(null===e||void 0===e||null===(t=e.token)||void 0===t?void 0:t.contract,":").concat(null===e||void 0===e||null===(n=e.token)||void 0===n?void 0:n.tokenId),collection:"",quantity:"1",currency:"ETH",price:(null!==(s=null===e||void 0===e||null===(r=e.market)||void 0===r||null===(o=r.floorAsk)||void 0===o||null===(i=o.price)||void 0===i?void 0:i.amount)&&void 0!==s?s:0).toString(),amount:"",start_time:"",end_time:""}}))},C=V.orders.reduce((function(e,t){return e+Number(null===t||void 0===t?void 0:t.price)}),0),u>0&&Number(C)<=u)throw new Error(g.setting.t("errcode_22000",{ns:"zero_gas"}));if(m>0&&V.orders.length>m)throw new Error(g.setting.t("errcode_22001",{ns:"zero_gas"}));if(Z=(0,_.X)(T.S9,V),I=Z.obj,Z.str,z=g.god.currentNetwork,z.account,z.signer,z.currentChain,z.provider,!(M=z.walletClient))throw new Error("No signer");F="",a.label=2;case 2:return a.trys.push([2,4,,5]),[4,null===M||void 0===M?void 0:M.signTypedData(I)];case 3:return F=a.sent(),[3,5];case 4:throw a.sent(),new Error("User Rejected");case 5:return N={sign_data:{domain:I.domain,message:I.message},signature:F},[4,d.Z.zeroGas.buyZeroGasToken(N)];case 6:if(x=a.sent(),w=x,0!==x.data.status)throw new Error(x.data.msg);return B=(0,y.eS)(x.data.data),c.notificationV2.success(B.title,B.message,"success"),g.zeroGasShoppingcart.clearShoppingcart(),setTimeout((function(){S.Y.emit("token.buy.success",b.map((function(e){return(0,p.sH)(e)})))}),1500),null===e||void 0===e||e(),[3,9];case 7:return G=a.sent(),s.zeroGasShoppingcart.clearShoppingcart(),Y=(null===w||void 0===w||null===(O=w.data)||void 0===O?void 0:O.status)?s.setting.t("errcode_".concat(Math.abs(w.data.status)),{ns:"zero_gas"}):G.message,c.notificationV2.error(s.setting.t("offer_failed",{ns:"zero_gas"}),Y),[3,9];case 8:return S.Y.emit("wallet.data.refresh"),[7];case 9:return[2]}}))}));return function(t){return e.apply(this,arguments)}}()});var v=this;this.marketBuyState=new l.C({function:function(){var e=(0,r.Z)((function(e,t,n){var r,o,i,s,l,u,h,m,w,p,g,k,b,V,C,Z,I,z,M,F,N,x,B,G,O,Y;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:l=(0,f.bh)(),u=l.god.currentNetwork,u.account,u.signer,u.currentChain,u.provider,m=null!==(h=null===(r=l.user)||void 0===r||null===(o=r.zeroGasExchangeInfo)||void 0===o?void 0:o.order_minimum_money)&&void 0!==h?h:0,p=null!==(w=null===(i=l.user)||void 0===i||null===(s=i.zeroGasExchangeInfo)||void 0===s?void 0:s.order_maximum_batch)&&void 0!==w?w:0,l.god.walletActionCheck(T.S9),v.sweepSubmitErrorTips.setValue(""),a.label=1;case 1:if(a.trys.push([1,8,9,10]),V={network:(0,E.ns)(T.S9),address:null===(k=l.god.account)||void 0===k?void 0:k.toLocaleLowerCase(),side:"BUY",order_type:"MARKET",orders:[{order_id:"",token:"",collection:null===(b=v.collectionId)||void 0===b?void 0:b.toLocaleLowerCase(),quantity:"",currency:"ETH",price:String(e),amount:String(t),start_time:"",end_time:""}]},m>0&&t<=m)throw new Error(l.setting.t("errcode_22000",{ns:"zero_gas"}));if(p>0&&V.orders.length>p)throw new Error(l.setting.t("errcode_22001",{ns:"zero_gas"}));if(C=(0,_.X)(T.S9,V),Z=C.obj,C.str,I=l.god.currentNetwork,I.account,z=I.signer,I.currentChain,I.provider,M=I.walletClient,!z)throw new Error("No signer");a.label=2;case 2:return a.trys.push([2,4,5,6]),[4,null===M||void 0===M?void 0:M.signTypedData(Z)];case 3:return F=a.sent(),[3,6];case 4:throw a.sent(),new Error("User Rejected");case 5:return[7];case 6:return N={sign_data:{domain:Z.domain,message:Z.message},signature:F},[4,d.Z.zeroGas.buyZeroGasToken(N)];case 7:if(x=a.sent(),g=x,0!==x.data.status)throw new Error(x.data.msg);if("error"==(B=(0,y._B)(x.data.data)).icon)throw new Error(B.message);return setTimeout((function(){S.Y.emit("token.buy.success",[])}),1500),c.notificationV2.success(B.title,B.message,B.icon),null===n||void 0===n||n(),[3,10];case 8:return G=a.sent(),Y=(null===g||void 0===g||null===(O=g.data)||void 0===O?void 0:O.status)?l.setting.t("errcode_".concat(g.data.status),{ns:"zero_gas"}):G.message,c.notificationV2.error(l.setting.t("buy_failed",{ns:"zero_gas"}),Y),[3,10];case 9:return S.Y.emit("wallet.data.refresh"),[7];case 10:return[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}()}),this.collection={},this.filter={source:"",onlyBuyNow:!1,maxFloorAskPrice:"",minFloorAskPrice:"",maxRarityRank:"",minRarityRank:"",attributes:[],tokenName:""},this.tokenInfoModalVisible=new g.mZ,this.collectionInfoModalVisible=new g.mZ,this.tokenInfoDetail=null,(0,u.ky)(this),(0,u.U5)((function(){return t.inOrderBookVisibleMode.value}),(function(e){e||(t.inOrderBookMode.setFalse(),t.inOrderBookSellMode.setFalse(),t.selectedOwnerTokens.clear())}))}var t=e.prototype;return t.setActivitiesType=function(e){this.activitiesFilter.types=e},t.clearFilter=function(){this.filter={source:"",onlyBuyNow:!1,maxFloorAskPrice:"",minFloorAskPrice:"",maxRarityRank:"",minRarityRank:"",attributes:[],tokenName:""}},t.updateFilter=function(e,t){this.filter[e]=t},t.init=function(){},t.clearAllState=function(){this.collection={},this.inOrderBookMode.setFalse(),this.inOrderBookSellMode.setFalse(),this.inOrderBookVisibleMode.setFalse(),this.inSweepMode.setFalse(),this.ableSweepTokens=[],this.ownerTokens.setValue([]),this.ownerTokens.loading.setFalse(),this.bidOrders.setValue([]),this.bidOrders.loading.setFalse()},(0,i.Z)(e,[{key:"chainId",get:function(){return(0,v.Vl)(this.chain).id}},{key:"collectionId",get:function(){var e;return null===(e=this.collection)||void 0===e?void 0:e.id}}]),e}(),C=new V;function Z(){return C}}}]);